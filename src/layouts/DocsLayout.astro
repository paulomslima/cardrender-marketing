---
import BaseLayout from "./BaseLayout.astro";
import { FileText, BookOpen, Users, Palette, BarChart3, Code, Shield } from "lucide-astro";

const { title, description } = Astro.props;

const pages = [
  { label: "Getting Started", href: "/docs/getting-started", icon: FileText },
  { label: "Teams & Roles", href: "/docs/teams", icon: Users },
  { label: "Branding & Templates", href: "/docs/branding-and-templates", icon: Palette },
  { label: "Analytics", href: "/docs/analytics", icon: BarChart3 },
  { label: "Public API", href: "/docs/api", icon: Code },
  { label: "Security", href: "/docs/security", icon: Shield },
];
---

<BaseLayout title={title} description={description}>
  <div class="docs-hero">
    <div class="container">
      <div class="docs-breadcrumb">
        <a href="/">Home</a>
        <span>/</span>
        <a href="/docs">Documentation</a>
      </div>
    </div>
  </div>
  
  <section class="docs-section">
    <div class="container docs-container docs-layout">
      <aside class="docs-sidebar">
        <div class="docs-nav-header">
          <BookOpen size={20} />
          <h3>Documentation</h3>
        </div>
        <nav class="docs-nav">
          {pages.map((page) => {
            const Icon = page.icon;
            const isActive = Astro.url.pathname === page.href;
            return (
              <a class={isActive ? "active" : ""} href={page.href}>
                <Icon size={18} />
                <span>{page.label}</span>
              </a>
            );
          })}
        </nav>
      </aside>
      
      <article class="docs-content">
        <slot />
      </article>
      
      <aside class="docs-toc">
        <div class="toc-header">
          <h4>On this page</h4>
        </div>
        <nav class="toc-nav" id="toc-nav" aria-label="Table of contents">
          <!-- Will be populated by JavaScript -->
        </nav>
      </aside>
    </div>
  </section>
</BaseLayout>

<script>
  // Lightweight TOC generator - SEO and LLM friendly
  function generateTOC() {
    const content = document.querySelector('.docs-content, .docs-prose');
    const tocNav = document.getElementById('toc-nav');
    
    if (!content || !tocNav) return;
    
    const headings = Array.from(content.querySelectorAll('h2, h3'));
    
    if (headings.length === 0) {
      const tocContainer = tocNav.closest('.docs-toc') as HTMLElement;
      if (tocContainer) tocContainer.style.display = 'none';
      return;
    }
    
    // Create simple list structure for better semantics
    const list = document.createElement('ul');
    list.className = 'toc-list';
    
    headings.forEach((heading, index) => {
      // Generate ID from text content
      if (!heading.id) {
        heading.id = heading.textContent
          ?.toLowerCase()
          .trim()
          .replace(/[^a-z0-9]+/g, '-')
          .replace(/^-+|-+$/g, '') || `section-${index}`;
      }
      
      const item = document.createElement('li');
      item.className = heading.tagName === 'H3' ? 'toc-item toc-item-nested' : 'toc-item';
      
      const link = document.createElement('a');
      link.href = `#${heading.id}`;
      link.textContent = heading.textContent || '';
      link.className = 'toc-link';
      link.setAttribute('data-heading', heading.id);
      
      item.appendChild(link);
      list.appendChild(item);
    });
    
    tocNav.appendChild(list);
    
    // Simple scroll spy
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const id = entry.target.getAttribute('id');
        const link = tocNav.querySelector(`a[data-heading="${id}"]`);
        
        if (entry.isIntersecting) {
          // Remove active from all
          tocNav.querySelectorAll('.toc-link').forEach(l => l.classList.remove('active'));
          // Add active to current
          link?.classList.add('active');
        }
      });
    }, {
      rootMargin: '-100px 0px -80% 0px'
    });
    
    // Observe all headings
    headings.forEach(heading => observer.observe(heading));
  }
  
  // Initialize on load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', generateTOC);
  } else {
    generateTOC();
  }
  
  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', generateTOC);
</script>

<style>
  .docs-hero {
    background: linear-gradient(135deg, hsl(var(--primary) / 0.05), hsl(var(--secondary) / 0.05));
    border-bottom: 1px solid hsl(var(--border));
    padding: 1.5rem 0;
  }
  
  .docs-breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: hsl(var(--muted-foreground));
  }
  
  .docs-breadcrumb a {
    color: hsl(var(--muted-foreground));
    transition: color 150ms;
  }
  
  .docs-breadcrumb a:hover {
    color: hsl(var(--primary));
  }
  
  .docs-section {
    padding: 2rem 0 4rem;
  }
  
  .docs-layout {
    display: grid;
    grid-template-columns: 220px 1fr 220px;
    gap: 3.5rem;
    align-items: start;
  }
  
  /* Sidebar Navigation */
  .docs-sidebar {
    position: sticky;
    top: 6rem;
    max-height: calc(100vh - 8rem);
    overflow-y: auto;
  }
  
  .docs-nav-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }
  
  .docs-nav-header h3 {
    margin: 0;
    font-size: 0.875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: hsl(var(--muted-foreground));
  }
  
  .docs-nav {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }
  
  .docs-nav a {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.625rem 0.75rem;
    color: hsl(var(--muted-foreground));
    font-weight: 500;
    font-size: 0.875rem;
    border-radius: 8px;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .docs-nav a:hover {
    background: hsl(var(--muted) / 0.1);
    color: hsl(var(--foreground));
  }
  
  .docs-nav a.active {
    background: hsl(var(--primary) / 0.1);
    color: hsl(var(--primary));
    font-weight: 600;
  }
  
  /* Main Content */
  .docs-content {
    padding: 0;
    min-height: 60vh;
  }
  
  /* Table of Contents - Flowbite-inspired */
  .docs-toc {
    position: sticky;
    top: 6rem;
    max-height: calc(100vh - 8rem);
    overflow-y: auto;
    background: hsl(var(--card));
    border: 1px solid hsl(var(--border));
    border-radius: 12px;
    padding: 1.25rem;
  }
  
  .toc-header {
    margin-bottom: 1rem;
    padding-bottom: 0.875rem;
    border-bottom: 1px solid hsl(var(--border));
  }
  
  .toc-header h4 {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: hsl(var(--muted-foreground));
    margin: 0;
  }
  
  .toc-nav {
    /* Remove sticky from inner element */
  }
  
  .toc-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }
  
  .toc-item {
    margin: 0;
  }
  
  .toc-item-nested {
    margin-left: 0.75rem;
  }
  
  .toc-link {
    display: block;
    font-size: 0.8125rem;
    color: hsl(var(--muted-foreground));
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
    line-height: 1.4;
    text-decoration: none;
    font-weight: 500;
    position: relative;
  }
  
  .toc-link::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 3px;
    height: 0;
    background: hsl(var(--primary));
    border-radius: 0 2px 2px 0;
    transition: height 150ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .toc-link:hover {
    color: hsl(var(--foreground));
    background: hsl(var(--muted) / 0.15);
  }
  
  .toc-link.active {
    color: hsl(var(--primary));
    background: hsl(var(--primary) / 0.08);
    font-weight: 600;
  }
  
  .toc-link.active::before {
    height: 60%;
  }
  
  /* Responsive */
  @media (max-width: 1280px) {
    .docs-layout {
      grid-template-columns: 200px 1fr;
      gap: 2.5rem;
    }
    
    .docs-toc {
      display: none;
    }
  }
  
  @media (max-width: 900px) {
    .docs-layout {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
    
    .docs-sidebar {
      position: static;
      max-height: none;
      background: hsl(var(--card));
      border: 1px solid hsl(var(--border));
      border-radius: 12px;
      padding: 1.25rem;
    }
    
    .docs-content {
      padding: 0;
    }
  }
  
  @media (max-width: 640px) {
    .docs-hero {
      padding: 1rem 0;
    }
    
    .docs-section {
      padding: 1.5rem 0 3rem;
    }
    
    .docs-sidebar {
      padding: 1rem;
      border-radius: 8px;
    }
  }
</style>

