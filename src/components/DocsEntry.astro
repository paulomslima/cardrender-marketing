---
import DocsLayout from "../layouts/DocsLayout.astro";
import { useTranslations } from "../lib/i18n";

const { entry, Content, headings = [] } = Astro.props;
const t = useTranslations(entry.data.lang);

// Determine proper language tag for jsonLd
const langMap: Record<string,string> = {
  en: 'en-US',
  es: 'es-ES',
  pt: 'pt-BR'
};
const inLanguage = langMap[entry.data.lang] ?? 'en-US';

// Generate enhanced jsonLd for SEO
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "TechArticle",
  headline: entry.data.title,
  description: entry.data.description,
  dateModified: new Date(entry.data.lastUpdated).toISOString(),
  author: {
    "@type": "Organization",
    name: "CardRender",
    url: "https://cardrender.com",
  },
  keywords: entry.data.keywords?.join(", ") || undefined,
  articleSection: entry.data.category,
  proficiencyLevel: entry.data.proficiencyLevel,
  inLanguage,
};
---

<DocsLayout
  title={entry.data.title}
  description={entry.data.description}
  jsonLd={jsonLd}
  headings={headings}
>
  <article class="docs-article" itemscope itemtype="https://schema.org/TechArticle">
    <header class="docs-article-header">
      <div class="docs-header">
        {entry.data.category && (
          <span class="docs-category-badge">{entry.data.category}</span>
        )}
        {entry.data.proficiencyLevel && (
          <span class="docs-level-badge">{entry.data.proficiencyLevel}</span>
        )}
      </div>

      <h1 class="docs-title" itemprop="headline">{entry.data.title}</h1>
      <p class="docs-description" itemprop="description">{entry.data.description}</p>
      <div class="docs-meta">
        <span class="docs-meta-label">{t('docs.lastUpdated')}:</span>
        <time
          class="docs-meta-value"
          itemprop="dateModified"
          datetime={new Date(entry.data.lastUpdated).toISOString()}
        >
          {new Intl.DateTimeFormat(entry.data.lang === 'pt' ? 'pt-BR' : entry.data.lang === 'es' ? 'es-ES' : 'en-US', { year: 'numeric', month: 'long', day: 'numeric' }).format(new Date(entry.data.lastUpdated))}
        </time>
      </div>
    </header>

    <div class="docs-prose" itemprop="articleBody">
      <div class="prose prose-lg max-w-none">
        <Content />
      </div>
    </div>
  </article>

  {entry.data.relatedDocs && entry.data.relatedDocs.length > 0 && (
    <div class="docs-related">
      <h3 class="docs-related-title">{t('docs.relatedDocs')}</h3>
      <div class="docs-related-grid">
        {entry.data.relatedDocs.map((doc) => (
          <a href={doc.url} class="docs-related-card">
            <span class="docs-related-icon">â†’</span>
            <span class="docs-related-text">{doc.title}</span>
          </a>
        ))}
      </div>
    </div>
  )}
</DocsLayout>
