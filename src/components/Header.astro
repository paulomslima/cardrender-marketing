---
import { APP_URL } from "../lib/config";
import LanguageSwitcher from "./LanguageSwitcher.astro";
import { getLangFromUrl, useTranslations, getLocalizedPath } from "../lib/i18n";

const { currentPath } = Astro.props;
const currentLang = getLangFromUrl(Astro.url);
const t = useTranslations(currentLang);
---

<nav class="site-header sticky top-0 z-50 backdrop-blur-lg bg-background/95 border-b border-border/40 p-4">
  <div class="container mx-auto flex flex-wrap items-center justify-between p-0">
    <a href="/" class="flex items-center">
      <img src="/cardrender.svg" alt="CardRender" class="h-[34px] max-w-[196px]" />
    </a>
    
      <div class="flex items-center gap-3 md:order-2">
      <div class="hidden md:block">
        <LanguageSwitcher />
      </div>
      <a href={`${APP_URL}/login`} class="button ghost hidden md:inline-flex">
        {t('auth.signIn')}
      </a>
      <a href={`${APP_URL}/register`} class="button primary">
        {t('auth.startFree')}
      </a>
      <button 
        data-collapse-toggle="navbar-menu" 
        type="button" 
        class="inline-flex items-center p-2 w-10 h-10 justify-center text-foreground rounded-lg md:hidden hover:bg-muted/50 focus:outline-none focus:ring-2 focus:ring-muted"
        aria-controls="navbar-menu" 
        aria-expanded="false"
      >
        <span class="sr-only">Open main menu</span>
        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
        </svg>
      </button>
    </div>
    
    <div class="hidden w-full md:block md:w-auto md:order-1" id="navbar-menu">
      <ul class="flex flex-col p-5 md:p-0 mt-5 md:mt-0 md:flex-row md:space-x-6 border border-border rounded-lg md:border-0 bg-card md:bg-transparent">
        <li>
          <a 
            href={getLocalizedPath('/features', currentLang)} 
            class={`block py-2 px-3 rounded md:p-0 transition-colors ${
              currentPath === getLocalizedPath('/features', currentLang) 
                ? "text-foreground md:text-foreground relative md:after:content-[''] md:after:absolute md:after:-bottom-4 md:after:left-0 md:after:right-0 md:after:h-0.5 md:after:bg-primary md:after:rounded" 
                : "text-muted-foreground hover:text-foreground"
            }`}
          >
            {t('nav.features')}
          </a>
        </li>
        <li>
          <a 
            href={getLocalizedPath('/pricing', currentLang)} 
            class={`block py-2 px-3 rounded md:p-0 transition-colors ${
              currentPath === getLocalizedPath('/pricing', currentLang) 
                ? "text-foreground md:text-foreground relative md:after:content-[''] md:after:absolute md:after:-bottom-4 md:after:left-0 md:after:right-0 md:after:h-0.5 md:after:bg-primary md:after:rounded" 
                : "text-muted-foreground hover:text-foreground"
            }`}
          >
            {t('nav.pricing')}
          </a>
        </li>
        <li>
          <a 
            href={getLocalizedPath('/blog', currentLang)} 
            class={`block py-2 px-3 rounded md:p-0 transition-colors ${
              currentPath?.startsWith(getLocalizedPath('/blog', currentLang)) 
                ? "text-foreground md:text-foreground relative md:after:content-[''] md:after:absolute md:after:-bottom-4 md:after:left-0 md:after:right-0 md:after:h-0.5 md:after:bg-primary md:after:rounded" 
                : "text-muted-foreground hover:text-foreground"
            }`}
          >
            {t('nav.blog')}
          </a>
        </li>
        <li>
          <a 
            href={getLocalizedPath('/docs', currentLang)} 
            class={`block py-2 px-3 rounded md:p-0 transition-colors ${
              currentPath?.startsWith(getLocalizedPath('/docs', currentLang)) 
                ? "text-foreground md:text-foreground relative md:after:content-[''] md:after:absolute md:after:-bottom-4 md:after:left-0 md:after:right-0 md:after:h-0.5 md:after:bg-primary md:after:rounded" 
                : "text-muted-foreground hover:text-foreground"
            }`}
          >
            {t('nav.docs')}
          </a>
        </li>
        <li class="md:hidden pt-4 mt-4 border-t border-border">
          <a 
            href={`${APP_URL}/login`} 
            class="block py-2 px-3 text-center rounded border border-border text-muted-foreground hover:bg-muted/50 mb-3"
          >
            Sign in
          </a>
          <div class="flex justify-center">
            <LanguageSwitcher />
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script>
  import { initFlowbite } from 'flowbite';
  
  // Initialize Flowbite on page load
  document.addEventListener('DOMContentLoaded', () => {
    initFlowbite();
  });
  
  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', () => {
    initFlowbite();
  });
</script>
